<!DOCTYPE html>
<html lang="en" ng-app="wd-students">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body ng-controller="StudentsListCtrl as ctrl">
<div class="container-fluid">
    <h1>Wirtualny dziekanat 2.0</h1>
    <p>{{ctrl.mod}}</p>
    <div class="table-responsive">
        <table class="table table-hover table-condensed">
            <thead>
            <tr>
                <th>#</th>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Program</th>
                <th>Age</th>
                <th>PESEL</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody ng-repeat="student in ctrl.students">
            <tr>
                <td ng-bind="::student.id"></td>
                <td ng-bind="::student.first_name"></td>
                <td ng-bind="::student.last_name"></td>
                <td ng-bind="::student.program"></td>
                <td ng-bind="::student.age"></td>
                <td ng-bind="::student.pesel"></td>
                <td>
                    <button type="button" class="btn btn-success">
                        <span class="glyphicon glyphicon-edit glyphicon-white"></span>
                    </button>
                    <button type="button" class="btn btn-danger" ng-click="ctrl.deleteStudent(student)">
                        <span class="remove glyphicon glyphicon-remove-sign glyphicon-white"></span>
                    </button>
                </td>
            </tr>
            </tbody>
            <div>
                <form name="newStudentForm" ng-submit="ctrl.createStudent()">
                    <input type="text" placeholder="First Name" ng-model="ctrl.newStudent.first_name" required>
                    <input type="text" placeholder="Last Name" ng-model="ctrl.newStudent.last_name" required>
                    <input type="text" placeholder="Program" ng-model="ctrl.newStudent.program" required>
                    <input type="text" placeholder="Age" ng-model="ctrl.newStudent.age" required>
                    <input type="text" placeholder="PESEL" ng-model="ctrl.newStudent.pesel" required>
                    <input type="submit" value="WprowadÅº" ng-disabled="newStudentForm.$invalid">
                </form>
            </div>
        </table>
    </div>
</div>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-resource.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


<script type="text/javascript">
    angular.module('wd-students', ['ngResource'])
        .controller('StudentsListCtrl', ['StudentService', '$http', function (studentSrv, $http) {
            var self = this;
            self.mod = 'Hello World!';
            self.students = [];
            self.newStudent = {};
            var fetchStudents = function () {
                self.students = studentSrv.query();
            };
            var resetNewStudent = function () {
                self.newStudent = {};
            };
            self.deleteStudent = function (student) {
                console.log('try to delete student of id: ' + student.id);
                studentSrv.delete(student).$promise
                    .then(fetchStudents);
            };
            self.createStudent = function () {
                studentSrv.save(self.newStudent).$promise
                    .then(fetchStudents)
                    .then(resetNewStudent);
            };

            fetchStudents();
        }])
        .factory('StudentService', ['$resource', function ($resource) {
            return $resource('/api/student/:id', {id: '@id'});
        }]);
</script>
</body>
</html>
